# Продуктовый помощник "Фудграм"

## Описание проекта

"Фудграм" — это онлайн-сервис, где пользователи могут публиковать рецепты, подписываться на публикации других пользователей, добавлять понравившиеся рецепты в «Избранное», а перед походом в магазин скачивать сводный список продуктов, необходимых для приготовления одного или нескольких выбранных блюд.

## Технологии

- Python 3.9+
- Django 3.2+
- Django REST framework
- Djoser
- PostgreSQL
- Nginx
- Gunicorn
- Docker
- Docker Compose

## Запуск проекта с нуля с использованием Docker

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/lolkander/foodgram-project-react.git
    ```

2.  **Перейдите в папку `infra`:**
    В этой папке находятся файлы `docker-compose.yml`, необходимые для запуска проекта.
    ```bash
    cd foodgram-project-react/infra/
    ```

3.  **Создайте файл `.env`** в директории `infra/` и заполните его необходимыми переменными окружения. Пример содержимого `.env` файла:
    ```env
    POSTGRES_USER=django_user
    POSTGRES_PASSWORD=django_password
    POSTGRES_DB=django_db
    DB_HOST=db
    DB_PORT=5432

    # Эти переменные используются Django напрямую
    SECRET_KEY=' ваш_секретный_ключ'
    DEBUG=True
    ALLOWED_HOSTS='127.0.0.1,localhost'
    ```
    **Важно:** `SECRET_KEY` должен быть уникальным и сложным. `ALLOWED_HOSTS` в production должен содержать доменное имя вашего сайта. Для локальной разработки `127.0.0.1,localhost` достаточно.

4.  **Соберите и запустите контейнеры Docker:**
    ```bash
    docker compose up --build
    ```
    Эта команда соберет образы (если они еще не собраны) и запустит все сервисы, описанные в `docker-compose.yml`.

5.  **Примените миграции базы данных:**
    Откройте новое окно терминала (или воспользуйтесь Docker Desktop -> Containers -> ваш_бекенд_контейнер -> Exec) и выполните команду в контейнере `backend`:
    ```bash
    docker compose exec backend python manage.py migrate
    ```

6.  **Создайте суперпользователя:**
    ```bash
    docker compose exec backend python manage.py createsuperuser
    ```
    Следуйте инструкциям в консоли, чтобы задать имя пользователя, email и пароль.

    **Важно:** Все последующие команды (`pip install`, `python manage.py ...`) в этом разделе должны выполняться из активированного виртуального окружения.

7.  **Загрузите ингредиенты в базу данных:**
    Для корректной работы рецептов необходимо загрузить начальные данные по ингредиентам.

    Команда для загрузки JSON-фикстуры `ingredients.json`, если она находится в папке `data` внутри вашего Django-приложения в контейнере:
    ```bash
    # Выполняем команду в контейнере backend:
    python manage.py load_ingredients
    ```

8.  **Проект должен быть доступен по следующим адресам:**
    *   Фронтенд: `http://localhost/`
    *   Бэкенд API: `http://localhost/api/`
    *   Документация API: `http://localhost/api/docs/`
    *   Административная панель Django: `http://localhost/admin/` (используйте учетные данные суперпользователя для входа).

## Запуск бэкенда для локальной разработки (без Docker)

Если вы хотите запустить только бэкенд Django локально для разработки или отладки (без использования Docker для самого бэкенда):

1.  **Убедитесь, что у вас установлен Python и pip.**
2.  **Перейдите в папку с бэкендом** (`backend/`).
3.  **Создайте и активируйте виртуальное окружение:**
    ```bash
    .\venv\Scripts\python
    ```

4.  **Установите зависимости (из активированного venv):**
    ```bash
    pip install -r requirements.txt
    ```
    (Убедитесь, что файл `requirements.txt` в папке бэкенда актуален).
5.  **Настройте переменные окружения:**
    Для работы Django могут потребоваться переменные окружения (например, `SECRET_KEY`, `DEBUG`, настройки базы данных). Вы можете установить их в вашей системе или использовать файл `.env` в папке бэкенда с помощью библиотеки `python-dotenv` (если она добавлена в `requirements.txt` и используется в `manage.py` или `settings.py`).
    Для подключения к базе данных, запущенной через Docker (сервис `db` из `docker-compose.yml в папке infra/`), вам нужно будет указать `DB_HOST=localhost` (или `127.0.0.1`) и порт, который PostgreSQL пробрасывает на хост (обычно 5432, если не изменен в `docker-compose.yml`).
6.  **Примените миграции (из активированного venv):**
    ```bash
    python manage.py migrate
    ```
7.  **Создайте суперпользователя (если еще не создан, из активированного venv):**
    ```bash
    python manage.py createsuperuser
    ```
8.  **Загрузите ингредиенты (если необходимо для локального запуска, из активированного venv):**
    ```bash
    python manage.py load_ingredients
    ```
    (При условии, что файл `data/ingredients.json` существует и доступен в вашем локальном проекте бэкенда).
9.  **Запустите сервер разработки (из активированного venv):**
    ```bash
    python manage.py runserver
    ```
    По умолчанию сервер будет доступен по адресу `http://127.0.0.1:8000/`. API будет доступно по `http://127.0.0.1:8000/api/`.

## Основные эндпоинты API (кратко)

Полная документация доступна по адресу `http://localhost/api/docs/` после запуска проекта через Docker или `http://127.0.0.1:8000/api/docs/` при локальном запуске.

*   `/api/users/` - Регистрация, список пользователей.
*   `/api/users/me/` - Получение/изменение данных текущего пользователя.
*   `/api/auth/token/login/` - Получение токена аутентификации.
*   `/api/auth/token/logout/` - Удаление токена аутентификации.
*   `/api/tags/` - Список тегов.
*   `/api/ingredients/` - Список ингредиентов.
*   `/api/recipes/` - Создание, чтение, обновление, удаление рецептов.
*   `/api/recipes/{id}/favorite/` - Добавить/удалить рецепт из избранного.
*   `/api/recipes/{id}/shopping_cart/` - Добавить/удалить рецепт из списка покупок.
*   `/api/recipes/download_shopping_cart/` - Скачать список покупок.
*   `/api/users/{id}/subscribe/` - Подписаться/отписаться от пользователя.
*   `/api/users/subscriptions/` - Список подписок пользователя.

## Остановка проекта

**Для Docker:**
Чтобы остановить все запущенные контейнеры:
```bash
cd foodgram-project-react/infra/ # Перейдите в папку с docker-compose.yml
docker compose down
```
Если вы хотите удалить и тома (данные базы данных, например), используйте:
```bash
docker compose down -v
```

**Для локального сервера (runserver):**
Нажмите `Ctrl+C` в терминале, где запущен сервер.

## Автор

Юров Павел